<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>

<script type="text/javascript">
	var last_timestamp = "";
	window.onload = function() {
		setInterval(function()
			{
				var scrollArea = $("scrollArea")
				if (last_timestamp!="") {
					$.get("/api/getlatestpost?timestamp="+encodeURIComponent(last_timestamp), function(data){
						$( "#message_feed" ).append( data );
					});

				}

				else {
					$.get("/api/getlatestpost", function(data){
						$( "#message_feed" ).append( data );
					});
				}
					scrollArea.scrollTop = scrollArea.scrollHeight;
			},
			1000);
	};

	function sendChatMessage() {
		console.log(document.getElementById('message_input').value)
		$.get("/post?message_input="+encodeURIComponent(document.getElementById('message_input').value), function(data){});
		document.getElementById('message_input').value=""
		return false
	}
</script>

<html>
	<head>
		<meta charset="utf-8">
		<title>StructChat</title>
		<link rel="stylesheet" type="text/css" href="/static/semantic.css">
		<script type="text/javascript" src="/static/semantic.js"></script>
	</head>
	<body>
		<style type="text/css">

			body {
				background-image: url('/static/blueprint_bg.jpg');
			}

			.menu {
				max-width: 95%;
			}

			.segment {
				max-width: 95%;
				opacity: 0.9;
				overflow: auto;
			}

			.scrollArea {
				height: 80%;
				max-height: 80%;
			}
			
		</style>
		{% include "header.html" %}
		<br>
		<div class="ui segment scrollArea" style="margin: 0 auto;">
			<div class="ui feed" id="message_feed" name="message_feed">
				<!-- {% for message in messages_ %}
					{% include "event.html" %}
				{% endfor %} -->
			</div>
		</div>
		<br>
		<div class="ui segment" style="margin: 0 auto;">
			<form onsubmit="return sendChatMessage();">
				<!-- {% csrf_token %} -->
				<div class="ui action input" style="width:100%;">
					<input placeholder="type message here" name="message_input" id="message_input" type="text">
					<button onclick="sendChatMessage();" class="ui orange button">Send</button>
				</div>
			</form>
		</div>
	</body>
</html>
